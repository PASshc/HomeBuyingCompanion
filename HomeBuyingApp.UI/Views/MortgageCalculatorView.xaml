<UserControl x:Class="HomeBuyingApp.UI.Views.MortgageCalculatorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:HomeBuyingApp.UI.Views"
             xmlns:converters="clr-namespace:HomeBuyingApp.UI.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:CurrencyConverter x:Key="CurrencyConverter"/>
        <converters:PercentageConverter x:Key="PercentageConverter"/>
    </UserControl.Resources>
    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        
        <StackPanel Grid.Column="0">
            <TextBlock Text="Mortgage Calculator" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"/>
            
            <GroupBox Header="Loan Details" Margin="0,0,0,10" Padding="5">
                <StackPanel>
                    <TextBlock Text="Purchase Price" />
                    <TextBox Text="{Binding PurchasePrice, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=LostFocus}" Margin="0,0,0,10" ToolTip="Total purchase price of the property"/>
                    
                    <TextBlock Text="Down Payment" />
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" Text="{Binding DownPaymentAmount, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0" ToolTip="Down payment amount ($)"/>
                        <TextBox Grid.Column="1" Text="{Binding DownPaymentPercent, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}" ToolTip="Down payment percentage (%)"/>
                    </Grid>
                    
                    <TextBlock Text="Interest Rate (%)" />
                    <TextBox Text="{Binding InterestRate, Converter={StaticResource PercentageConverter}, UpdateSourceTrigger=LostFocus}" Margin="0,0,0,10" ToolTip="Annual interest rate"/>
                    
                    <TextBlock Text="Loan Term (Years)" />
                    <TextBox Text="{Binding LoanTermYears, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10" ToolTip="Duration of the loan in years"/>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="Expenses &amp; Fees" Margin="0,0,0,10" Padding="5">
                <StackPanel>
                    <TextBlock Text="Annual Property Tax" />
                    <TextBox Text="{Binding PropertyTaxAnnualAmount, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=LostFocus}" Margin="0,0,0,10" ToolTip="Estimated annual property tax"/>

                    <TextBlock Text="Annual Home Insurance" />
                    <TextBox Text="{Binding HomeownerInsuranceAnnualAmount, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=LostFocus}" Margin="0,0,0,10" ToolTip="Estimated annual homeowner's insurance premium"/>

                    <TextBlock Text="PMI Rate (%)" />
                    <TextBox Text="{Binding PmiRate, Converter={StaticResource PercentageConverter}, UpdateSourceTrigger=LostFocus}" Margin="0,0,0,10" ToolTip="Private Mortgage Insurance rate (typically 0.5% - 1.5%)"/>

                    <TextBlock Text="Monthly HOA" />
                    <TextBox Text="{Binding HoaMonthlyAmount, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=LostFocus}" Margin="0,0,0,10" ToolTip="Monthly Homeowner Association fees"/>
                </StackPanel>
            </GroupBox>
        </StackPanel>
        
        <StackPanel Grid.Column="1" Margin="20,0,0,0">
            <TextBlock Text="Results" FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>
            
            <TextBlock Text="Monthly P&amp;I:" FontWeight="SemiBold"/>
            <TextBlock Text="{Binding MonthlyPrincipalAndInterest, StringFormat=C}" FontSize="16" Foreground="Green"/>

            <TextBlock Text="Monthly Tax:" FontWeight="SemiBold" Margin="0,5,0,0"/>
            <TextBlock Text="{Binding MonthlyPropertyTax, StringFormat=C}" FontSize="14"/>

            <TextBlock Text="Monthly Insurance:" FontWeight="SemiBold" Margin="0,5,0,0"/>
            <TextBlock Text="{Binding MonthlyHomeownerInsurance, StringFormat=C}" FontSize="14"/>

            <TextBlock Text="Monthly PMI:" FontWeight="SemiBold" Margin="0,5,0,0"/>
            <TextBlock Text="{Binding PmiMonthlyAmount, StringFormat=C}" FontSize="14"/>

            <TextBlock Text="Monthly HOA:" FontWeight="SemiBold" Margin="0,5,0,0"/>
            <TextBlock Text="{Binding HoaMonthlyAmount, StringFormat=C}" FontSize="14"/>
            
            <TextBlock Text="Total Monthly Payment:" FontWeight="SemiBold" Margin="0,15,0,0"/>
            <TextBlock Text="{Binding TotalMonthlyPayment, StringFormat=C}" FontSize="24" Foreground="Blue"/>
            
            <Expander Header="Amortization Schedule" Margin="0,20,0,0">
                <DataGrid ItemsSource="{Binding AmortizationSchedule}" AutoGenerateColumns="False" Height="300" CanUserAddRows="False" IsReadOnly="True" HeadersVisibility="Column">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Mo" Binding="{Binding Month}" Width="40"/>
                        <DataGridTextColumn Header="Payment" Binding="{Binding Payment, StringFormat=C}" Width="*"/>
                        <DataGridTextColumn Header="Principal" Binding="{Binding Principal, StringFormat=C}" Width="*"/>
                        <DataGridTextColumn Header="Interest" Binding="{Binding Interest, StringFormat=C}" Width="*"/>
                        <DataGridTextColumn Header="Balance" Binding="{Binding RemainingBalance, StringFormat=C}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Expander>
        </StackPanel>
    </Grid>
</UserControl>
