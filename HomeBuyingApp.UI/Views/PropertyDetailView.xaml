<UserControl x:Class="HomeBuyingApp.UI.Views.PropertyDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:HomeBuyingApp.UI.Views"
             xmlns:converters="clr-namespace:HomeBuyingApp.UI.Converters"
             xmlns:helpers="clr-namespace:HomeBuyingApp.UI.Helpers"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:CurrencyConverter x:Key="CurrencyConverter"/>
        <converters:PercentageConverter x:Key="PercentageConverter"/>
        <converters:BooleanToYesNoConverter x:Key="BooleanToYesNoConverter"/>
        <converters:NumberWithCommasConverter x:Key="NumberWithCommasConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
    </UserControl.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,20">
            <TextBlock Text="Property Details" FontSize="24" FontWeight="Bold"/>
            <Button Content="Paste details" Command="{Binding PasteDetailsFromClipboardCommand}" Padding="10,3" Margin="20,0,0,0" VerticalAlignment="Center"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Line 1: Address, City, State, Zip Code -->
                <TextBlock Text="Address:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.Address, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="City:" Grid.Row="0" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.City, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="State:" Grid.Row="0" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.State, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="7" Margin="0,5"/>

                <TextBlock Text="Zip Code:" Grid.Row="0" Grid.Column="9" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.ZipCode, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="10" Margin="0,5"/>

                <!-- Line 2: Bedrooms, Bathrooms, Square Feet, MLS # -->
                <TextBlock Text="Bedrooms:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.Bedrooms, UpdateSourceTrigger=PropertyChanged}" Grid.Row="1" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Bathrooms:" Grid.Row="1" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.Bathrooms, UpdateSourceTrigger=LostFocus, StringFormat={}{0:0.#}}" Grid.Row="1" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="Square Feet:" Grid.Row="1" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.SquareFeet, Converter={StaticResource NumberWithCommasConverter}, UpdateSourceTrigger=LostFocus}" Grid.Row="1" Grid.Column="7" Margin="0,5"/>

                <TextBlock Text="MLS #:" Grid.Row="1" Grid.Column="9" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.MlsNumber, UpdateSourceTrigger=PropertyChanged}" Grid.Row="1" Grid.Column="10" Margin="0,5"/>

                <!-- Line 3: HOA, HOA Fee -->
                <TextBlock Text="HOA:" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <ComboBox SelectedValue="{Binding Property.HasHoa, Converter={StaticResource BooleanToYesNoConverter}}" SelectedValuePath="Content" Grid.Row="2" Grid.Column="1" Margin="0,5">
                    <ComboBoxItem Content="Yes"/>
                    <ComboBoxItem Content="No"/>
                </ComboBox>

                <TextBlock Text="HOA Fee:" Grid.Row="2" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.HoaFee, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="2" Grid.Column="4" Margin="0,5"/>

                <!-- Line 4: List Price, Est. Offer, Willing to Pay -->
                <TextBlock Text="List Price:" Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.ListPrice, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="3" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Est. Offer:" Grid.Row="3" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.EstimatedOffer, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="3" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="Willing to Pay:" Grid.Row="3" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.WillingToPay, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="3" Grid.Column="7" Grid.ColumnSpan="4" Margin="0,5"/>

                <!-- Line 5: Status, Rating, Checkboxes -->
                <TextBlock Text="Status:" Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <ComboBox ItemsSource="{Binding Statuses}" SelectedItem="{Binding Property.Status, Mode=TwoWay}" Grid.Row="4" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Rating (1-5):" Grid.Row="4" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.Rating, UpdateSourceTrigger=PropertyChanged}" Grid.Row="4" Grid.Column="4" Margin="0,5"/>

                <StackPanel Orientation="Horizontal" Grid.Row="4" Grid.Column="6" Grid.ColumnSpan="5" Margin="0,5" VerticalAlignment="Center">
                    <CheckBox Content="Look At?" IsChecked="{Binding Property.LookAt}" Margin="0,0,20,0"/>
                    <CheckBox Content="Interest?" IsChecked="{Binding Property.Interest}" Margin="0,0,20,0"/>
                    <CheckBox Content="Archive" IsChecked="{Binding Property.IsArchived}"/>
                </StackPanel>

                <!-- Line 6: View Date, Inspection Date, Closing Date -->
                <TextBlock Text="Viewing Date:" Grid.Row="5" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <DatePicker SelectedDate="{Binding Property.ViewingDate, UpdateSourceTrigger=PropertyChanged}" Grid.Row="5" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Inspection Date:" Grid.Row="5" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <DatePicker SelectedDate="{Binding Property.InspectionDate, UpdateSourceTrigger=PropertyChanged}" Grid.Row="5" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="Closing Date:" Grid.Row="5" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <DatePicker SelectedDate="{Binding Property.ClosingDate, UpdateSourceTrigger=PropertyChanged}" Grid.Row="5" Grid.Column="7" Grid.ColumnSpan="4" Margin="0,5"/>

                <!-- Listing URL -->
                <TextBlock Text="Listing URL:" Grid.Row="6" Grid.Column="0" VerticalAlignment="Top" Margin="0,5"/>
                <StackPanel Grid.Row="6" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <TextBox Text="{Binding Property.ListingUrl, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,5"/>
                    <TextBlock TextTrimming="CharacterEllipsis" ToolTip="{Binding Property.ListingUrl}">
                        <Hyperlink NavigateUri="{Binding Property.ListingUrl}" RequestNavigate="Hyperlink_RequestNavigate">
                            <TextBlock Text="Open Listing in Browser"/>
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>

                <!-- Interior Features -->
                <TextBlock Text="Interior Features:" Grid.Row="7" Grid.Column="0" VerticalAlignment="Top" Margin="0,5" FontWeight="SemiBold"/>
                <StackPanel Grid.Row="7" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <!-- Flooring -->
                    <TextBlock Text="Flooring" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Carpet" IsChecked="{Binding Property.HasCarpet}" Margin="0,0,10,3"/>
                        <CheckBox Content="Tile" IsChecked="{Binding Property.HasTile}" Margin="0,0,10,3"/>
                        <CheckBox Content="Wood Flooring" IsChecked="{Binding Property.HasWoodFlooring}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Appliances -->
                    <TextBlock Text="Appliances" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Oven" IsChecked="{Binding Property.HasOven}" Margin="0,0,10,3"/>
                        <CheckBox Content="Refrigerator" IsChecked="{Binding Property.HasRefrigerator}" Margin="0,0,10,3"/>
                        <CheckBox Content="Washer/Dryer" IsChecked="{Binding Property.HasWasherDryer}" Margin="0,0,10,3"/>
                        <CheckBox Content="Dishwasher" IsChecked="{Binding Property.HasDishwasher}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Climate/Systems -->
                    <TextBlock Text="Climate/Systems" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="AC" IsChecked="{Binding Property.HasAC}" Margin="0,0,10,3"/>
                        <CheckBox Content="Central Heat" IsChecked="{Binding Property.HasCentralHeat}" Margin="0,0,10,3"/>
                        <CheckBox Content="Fireplace" IsChecked="{Binding Property.HasFireplace}" Margin="0,0,10,3"/>
                        <CheckBox Content="Ceiling Fans" IsChecked="{Binding Property.HasCeilingFans}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Storage -->
                    <TextBlock Text="Storage" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,3">
                        <CheckBox Content="Walk-in Closet" IsChecked="{Binding Property.HasWalkInCloset}" Margin="0,0,10,3"/>
                        <CheckBox Content="Attic" IsChecked="{Binding Property.HasAttic}" Margin="0,0,10,3"/>
                        <CheckBox Content="Basement" IsChecked="{Binding Property.HasBasement}" Margin="0,0,10,3"/>
                    </UniformGrid>
                </StackPanel>

                <!-- Exterior Features -->
                <TextBlock Text="Exterior Features:" Grid.Row="8" Grid.Column="0" VerticalAlignment="Top" Margin="0,5" FontWeight="SemiBold"/>
                <StackPanel Grid.Row="8" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <!-- Outdoor -->
                    <TextBlock Text="Outdoor" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Landscape" IsChecked="{Binding Property.HasLandscape}" Margin="0,0,10,3"/>
                        <CheckBox Content="Pool" IsChecked="{Binding Property.HasPool}" Margin="0,0,10,3"/>
                        <CheckBox Content="Jacuzzi" IsChecked="{Binding Property.HasJacuzzi}" Margin="0,0,10,3"/>
                        <CheckBox Content="Lanai" IsChecked="{Binding Property.HasLanai}" Margin="0,0,10,3"/>
                        <CheckBox Content="Covered Patio" IsChecked="{Binding Property.HasCoveredPatio}" Margin="0,0,10,3"/>
                        <CheckBox Content="Deck/Patio" IsChecked="{Binding Property.HasDeckPatio}" Margin="0,0,10,3"/>
                        <CheckBox Content="Fenced Yard" IsChecked="{Binding Property.HasFencedYard}" Margin="0,0,10,3"/>
                        <CheckBox Content="Sprinkler System" IsChecked="{Binding Property.HasSprinklerSystem}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Structures -->
                    <TextBlock Text="Structures" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,3">
                        <CheckBox Content="Garage" IsChecked="{Binding Property.HasGarage}" Margin="0,0,10,3"/>
                        <CheckBox Content="Carport" IsChecked="{Binding Property.HasCarport}" Margin="0,0,10,3"/>
                        <CheckBox Content="Storage Shed" IsChecked="{Binding Property.HasStorageShed}" Margin="0,0,10,3"/>
                        <CheckBox Content="Guest House" IsChecked="{Binding Property.HasGuestHouse}" Margin="0,0,10,3"/>
                    </UniformGrid>
                </StackPanel>

                <!-- Other Features -->
                <TextBlock Text="Other Features:" Grid.Row="9" Grid.Column="0" VerticalAlignment="Top" Margin="0,5" FontWeight="SemiBold"/>
                <StackPanel Grid.Row="9" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Solar Panels" IsChecked="{Binding Property.HasSolarPanels}" Margin="0,0,10,3"/>
                        <CheckBox Content="Security System" IsChecked="{Binding Property.HasSecuritySystem}" Margin="0,0,10,3"/>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox IsChecked="{Binding Property.HasCustomFeature1}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox Text="{Binding Property.CustomFeature1Name, UpdateSourceTrigger=PropertyChanged}" 
                                     Width="120" VerticalAlignment="Center" Padding="2"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox IsChecked="{Binding Property.HasCustomFeature2}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox Text="{Binding Property.CustomFeature2Name, UpdateSourceTrigger=PropertyChanged}" 
                                     Width="120" VerticalAlignment="Center" Padding="2"/>
                        </StackPanel>
                    </UniformGrid>
                    <TextBox Text="{Binding Property.OtherFeatures, UpdateSourceTrigger=PropertyChanged}" 
                             ToolTip="Other features not listed above"
                             Margin="0,0,0,5"/>
                </StackPanel>

                <!-- Comments -->
                <TextBlock Text="Comments:" Grid.Row="10" Grid.Column="0" VerticalAlignment="Top" Margin="0,5"/>
                <RichTextBox helpers:RichTextBoxBinding.XamlText="{Binding Property.Comments, Mode=TwoWay}"
                             Grid.Row="10" Grid.Column="1" Grid.ColumnSpan="10"
                             MinHeight="60" MaxHeight="200"
                             VerticalScrollBarVisibility="Auto"
                             Margin="0,5" />

                <!-- Notes -->
                <TextBlock Text="Notes:" Grid.Row="11" Grid.Column="0" VerticalAlignment="Top" Margin="0,5"/>
                <RichTextBox helpers:RichTextBoxBinding.XamlText="{Binding Property.Notes, Mode=TwoWay}"
                             Grid.Row="11" Grid.Column="1" Grid.ColumnSpan="10"
                             MinHeight="60" MaxHeight="200"
                             VerticalScrollBarVisibility="Auto"
                             Margin="0,5" />

                <!-- Property Images (up to 4) -->
                <TextBlock Text="Property Images" FontSize="18" FontWeight="Bold" Grid.Row="12" Grid.Column="0" Grid.ColumnSpan="11" Margin="0,20,0,10"/>
                
                <Grid Grid.Row="13" Grid.Column="0" Grid.ColumnSpan="11">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Image 1 -->
                    <Border Grid.Row="0" Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,10,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding HasImage1, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 1" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding PasteImage1Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding HasImage1, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Image1}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5"/>
                                <Button Content="✕" Command="{Binding DeleteImage1Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Image 2 -->
                    <Border Grid.Row="0" Grid.Column="1" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,0,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding HasImage2, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 2" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding PasteImage2Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding HasImage2, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Image2}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5"/>
                                <Button Content="✕" Command="{Binding DeleteImage2Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Image 3 -->
                    <Border Grid.Row="1" Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,10,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding HasImage3, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 3" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding PasteImage3Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding HasImage3, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Image3}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5"/>
                                <Button Content="✕" Command="{Binding DeleteImage3Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Image 4 -->
                    <Border Grid.Row="1" Grid.Column="1" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,0,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding HasImage4, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 4" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding PasteImage4Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding HasImage4, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Image4}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5"/>
                                <Button Content="✕" Command="{Binding DeleteImage4Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Attachments -->
                <TextBlock Text="Attachments" FontSize="18" FontWeight="Bold" Grid.Row="13" Grid.Column="0" Grid.ColumnSpan="11" Margin="0,20,0,10"/>
                
                <Grid Grid.Row="14" Grid.Column="0" Grid.ColumnSpan="11">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <Button Content="Add Attachment" Command="{Binding AddAttachmentCommand}" HorizontalAlignment="Left" Margin="0,0,0,10" Padding="10,5"/>
                    
                    <ListView ItemsSource="{Binding Attachments}" Grid.Row="1" MaxHeight="200" BorderThickness="1" BorderBrush="#CCCCCC">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="File Name" Width="250" DisplayMemberBinding="{Binding FileName}"/>
                                <GridViewColumn Header="Date" Width="100" DisplayMemberBinding="{Binding DateAdded, StringFormat=d}"/>
                                <GridViewColumn Header="Actions" Width="150">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Button Content="Open" Command="{Binding DataContext.OpenAttachmentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Margin="0,0,5,0" Padding="5,2"/>
                                                <Button Content="Delete" Command="{Binding DataContext.DeleteAttachmentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Padding="5,2"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>

                <!-- Mortgage Calculator -->
                <local:MortgageCalculatorView Grid.Row="15" Grid.Column="0" Grid.ColumnSpan="11" DataContext="{Binding MortgageCalculator}"/>

            </Grid>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Save" Command="{Binding SaveCommand}" Width="100" Margin="0,0,10,0" Padding="10,5"/>
            <Button Content="Cancel" Command="{Binding CancelCommand}" Width="100" Padding="10,5"/>
        </StackPanel>
    </Grid>
</UserControl>
