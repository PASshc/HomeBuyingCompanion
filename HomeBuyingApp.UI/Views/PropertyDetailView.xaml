<UserControl x:Class="HomeBuyingApp.UI.Views.PropertyDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:HomeBuyingApp.UI.Views"
             xmlns:converters="clr-namespace:HomeBuyingApp.UI.Converters"
             xmlns:helpers="clr-namespace:HomeBuyingApp.UI.Helpers"
             xmlns:controls="clr-namespace:HomeBuyingApp.UI.Controls"
             xmlns:models="clr-namespace:HomeBuyingApp.Core.Models;assembly=HomeBuyingApp.Core"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:CurrencyConverter x:Key="CurrencyConverter"/>
        <converters:PercentageConverter x:Key="PercentageConverter"/>
        <converters:BooleanToYesNoConverter x:Key="BooleanToYesNoConverter"/>
        <converters:NumberWithCommasConverter x:Key="NumberWithCommasConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <converters:TagTypeToColorConverter x:Key="TagTypeToColorConverter"/>
    </UserControl.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,20">
            <TextBlock Text="Property Details" FontSize="24" FontWeight="Bold"/>
            <Button Content="Paste details" Command="{Binding PasteDetailsFromClipboardCommand}" Padding="10,3" Margin="20,0,0,0" VerticalAlignment="Center"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/> <!-- Row 12: PROs/CONs Tags -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Line 1: Address, City, State, Zip Code -->
                <TextBlock Text="Address:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.Address, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="City:" Grid.Row="0" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.City, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="State:" Grid.Row="0" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.State, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="7" Margin="0,5"/>

                <TextBlock Text="Zip Code:" Grid.Row="0" Grid.Column="9" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.ZipCode, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="10" Margin="0,5"/>

                <!-- Line 2: Bedrooms, Bathrooms, Square Feet, MLS # -->
                <TextBlock Text="Bedrooms:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.Bedrooms, UpdateSourceTrigger=PropertyChanged}" Grid.Row="1" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Bathrooms:" Grid.Row="1" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.Bathrooms, UpdateSourceTrigger=LostFocus, StringFormat={}{0:0.#}}" Grid.Row="1" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="Square Feet:" Grid.Row="1" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.SquareFeet, Converter={StaticResource NumberWithCommasConverter}, UpdateSourceTrigger=LostFocus}" Grid.Row="1" Grid.Column="7" Margin="0,5"/>

                <TextBlock Text="MLS #:" Grid.Row="1" Grid.Column="9" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.MlsNumber, UpdateSourceTrigger=PropertyChanged}" Grid.Row="1" Grid.Column="10" Margin="0,5"/>

                <!-- Line 3: HOA, HOA Fee -->
                <TextBlock Text="HOA:" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <ComboBox SelectedValue="{Binding Property.HasHoa, Converter={StaticResource BooleanToYesNoConverter}}" SelectedValuePath="Content" Grid.Row="2" Grid.Column="1" Margin="0,5">
                    <ComboBoxItem Content="Yes"/>
                    <ComboBoxItem Content="No"/>
                </ComboBox>

                <TextBlock Text="HOA Fee:" Grid.Row="2" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.HoaFee, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="2" Grid.Column="4" Margin="0,5"/>

                <!-- Line 4: List Price, Est. Offer, Willing to Pay -->
                <TextBlock Text="List Price:" Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.ListPrice, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="3" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Est. Offer:" Grid.Row="3" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.EstimatedOffer, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="3" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="Willing to Pay:" Grid.Row="3" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <TextBox Text="{Binding Property.WillingToPay, Converter={StaticResource CurrencyConverter}, UpdateSourceTrigger=PropertyChanged}" Grid.Row="3" Grid.Column="7" Grid.ColumnSpan="4" Margin="0,5"/>

                <!-- Line 5: Status, Rating, Checkboxes -->
                <TextBlock Text="Status:" Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <ComboBox ItemsSource="{Binding Statuses}" SelectedItem="{Binding Property.Status, Mode=TwoWay}" Grid.Row="4" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Rating:" Grid.Row="4" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <controls:StarRatingControl Rating="{Binding Property.Rating, Mode=TwoWay}" Grid.Row="4" Grid.Column="4" VerticalAlignment="Center" Margin="0,5"/>

                <StackPanel Orientation="Horizontal" Grid.Row="4" Grid.Column="6" Grid.ColumnSpan="5" Margin="0,5" VerticalAlignment="Center">
                    <CheckBox Content="Look At?" IsChecked="{Binding Property.LookAt}" Margin="0,0,20,0"/>
                    <CheckBox Content="Interest?" IsChecked="{Binding Property.Interest}" Margin="0,0,20,0"/>
                    <CheckBox Content="Archive" IsChecked="{Binding Property.IsArchived}"/>
                </StackPanel>

                <!-- Line 6: View Date, Inspection Date, Closing Date -->
                <TextBlock Text="Viewing Date:" Grid.Row="5" Grid.Column="0" VerticalAlignment="Center" Margin="0,5"/>
                <DatePicker SelectedDate="{Binding Property.ViewingDate, UpdateSourceTrigger=PropertyChanged}" Grid.Row="5" Grid.Column="1" Margin="0,5"/>

                <TextBlock Text="Inspection Date:" Grid.Row="5" Grid.Column="3" VerticalAlignment="Center" Margin="0,5"/>
                <DatePicker SelectedDate="{Binding Property.InspectionDate, UpdateSourceTrigger=PropertyChanged}" Grid.Row="5" Grid.Column="4" Margin="0,5"/>

                <TextBlock Text="Closing Date:" Grid.Row="5" Grid.Column="6" VerticalAlignment="Center" Margin="0,5"/>
                <DatePicker SelectedDate="{Binding Property.ClosingDate, UpdateSourceTrigger=PropertyChanged}" Grid.Row="5" Grid.Column="7" Grid.ColumnSpan="4" Margin="0,5"/>

                <!-- Listing URL -->
                <TextBlock Text="Listing URL:" Grid.Row="6" Grid.Column="0" VerticalAlignment="Top" Margin="0,5"/>
                <StackPanel Grid.Row="6" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <TextBox Text="{Binding Property.ListingUrl, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,5"/>
                    <TextBlock TextTrimming="CharacterEllipsis" ToolTip="{Binding Property.ListingUrl}">
                        <Hyperlink NavigateUri="{Binding Property.ListingUrl}" RequestNavigate="Hyperlink_RequestNavigate">
                            <TextBlock Text="Open Listing in Browser"/>
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>

                <!-- Interior Features -->
                <StackPanel Orientation="Horizontal" Grid.Row="7" Grid.Column="0" VerticalAlignment="Top" Margin="0,5">
                    <TextBlock Text="â– " Foreground="#4CAF50" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="Interior:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Row="7" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <!-- Flooring -->
                    <TextBlock Text="Flooring" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Carpet" IsChecked="{Binding Property.HasCarpet}" Margin="0,0,10,3"/>
                        <CheckBox Content="Tile" IsChecked="{Binding Property.HasTile}" Margin="0,0,10,3"/>
                        <CheckBox Content="Wood Flooring" IsChecked="{Binding Property.HasWoodFlooring}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Appliances -->
                    <TextBlock Text="Appliances" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Oven" IsChecked="{Binding Property.HasOven}" Margin="0,0,10,3"/>
                        <CheckBox Content="Refrigerator" IsChecked="{Binding Property.HasRefrigerator}" Margin="0,0,10,3"/>
                        <CheckBox Content="Washer/Dryer" IsChecked="{Binding Property.HasWasherDryer}" Margin="0,0,10,3"/>
                        <CheckBox Content="Dishwasher" IsChecked="{Binding Property.HasDishwasher}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Climate/Systems -->
                    <TextBlock Text="Climate/Systems" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="AC" IsChecked="{Binding Property.HasAC}" Margin="0,0,10,3"/>
                        <CheckBox Content="Central Heat" IsChecked="{Binding Property.HasCentralHeat}" Margin="0,0,10,3"/>
                        <CheckBox Content="Fireplace" IsChecked="{Binding Property.HasFireplace}" Margin="0,0,10,3"/>
                        <CheckBox Content="Ceiling Fans" IsChecked="{Binding Property.HasCeilingFans}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Storage -->
                    <TextBlock Text="Storage" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,3">
                        <CheckBox Content="Walk-in Closet" IsChecked="{Binding Property.HasWalkInCloset}" Margin="0,0,10,3"/>
                        <CheckBox Content="Attic" IsChecked="{Binding Property.HasAttic}" Margin="0,0,10,3"/>
                        <CheckBox Content="Basement" IsChecked="{Binding Property.HasBasement}" Margin="0,0,10,3"/>
                    </UniformGrid>
                </StackPanel>

                <!-- Exterior Features -->
                <StackPanel Orientation="Horizontal" Grid.Row="8" Grid.Column="0" VerticalAlignment="Top" Margin="0,5">
                    <TextBlock Text="â—" Foreground="#8BC34A" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="Exterior:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Row="8" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <!-- Outdoor -->
                    <TextBlock Text="Outdoor" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Landscape" IsChecked="{Binding Property.HasLandscape}" Margin="0,0,10,3"/>
                        <CheckBox Content="Pool" IsChecked="{Binding Property.HasPool}" Margin="0,0,10,3"/>
                        <CheckBox Content="Jacuzzi" IsChecked="{Binding Property.HasJacuzzi}" Margin="0,0,10,3"/>
                        <CheckBox Content="Lanai" IsChecked="{Binding Property.HasLanai}" Margin="0,0,10,3"/>
                        <CheckBox Content="Covered Patio" IsChecked="{Binding Property.HasCoveredPatio}" Margin="0,0,10,3"/>
                        <CheckBox Content="Deck/Patio" IsChecked="{Binding Property.HasDeckPatio}" Margin="0,0,10,3"/>
                        <CheckBox Content="Fenced Yard" IsChecked="{Binding Property.HasFencedYard}" Margin="0,0,10,3"/>
                        <CheckBox Content="Sprinkler System" IsChecked="{Binding Property.HasSprinklerSystem}" Margin="0,0,10,3"/>
                    </UniformGrid>
                    <!-- Structures -->
                    <TextBlock Text="Structures" FontSize="11" Foreground="Gray" Margin="0,0,0,3"/>
                    <UniformGrid Columns="4" Margin="0,0,0,3">
                        <CheckBox Content="Garage" IsChecked="{Binding Property.HasGarage}" Margin="0,0,10,3"/>
                        <CheckBox Content="Carport" IsChecked="{Binding Property.HasCarport}" Margin="0,0,10,3"/>
                        <CheckBox Content="Storage Shed" IsChecked="{Binding Property.HasStorageShed}" Margin="0,0,10,3"/>
                        <CheckBox Content="Guest House" IsChecked="{Binding Property.HasGuestHouse}" Margin="0,0,10,3"/>
                    </UniformGrid>
                </StackPanel>

                <!-- Other Features -->
                <StackPanel Orientation="Horizontal" Grid.Row="9" Grid.Column="0" VerticalAlignment="Top" Margin="0,5">
                    <TextBlock Text="â˜…" Foreground="#FFC107" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="Other:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Row="9" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <UniformGrid Columns="4" Margin="0,0,0,8">
                        <CheckBox Content="Solar Panels" IsChecked="{Binding Property.HasSolarPanels}" Margin="0,0,10,3"/>
                        <CheckBox Content="Security System" IsChecked="{Binding Property.HasSecuritySystem}" Margin="0,0,10,3"/>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox IsChecked="{Binding Property.HasCustomFeature1}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox Text="{Binding Property.CustomFeature1Name, UpdateSourceTrigger=PropertyChanged}" 
                                     Width="120" VerticalAlignment="Center" Padding="2"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox IsChecked="{Binding Property.HasCustomFeature2}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <TextBox Text="{Binding Property.CustomFeature2Name, UpdateSourceTrigger=PropertyChanged}" 
                                     Width="120" VerticalAlignment="Center" Padding="2"/>
                        </StackPanel>
                    </UniformGrid>
                    
                    <!-- Other Features as Chips -->
                    <ItemsControl ItemsSource="{Binding OtherFeaturesList}" Margin="0,0,0,8">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#00897B" CornerRadius="12" Padding="10,5" Margin="0,0,6,6">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding}" Foreground="White" VerticalAlignment="Center"/>
                                        <Button Content="âœ•" 
                                                Command="{Binding DataContext.RemoveOtherFeatureCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                CommandParameter="{Binding}"
                                                Background="Transparent" Foreground="White" BorderThickness="0"
                                                Padding="6,0,0,0" FontWeight="Bold" Cursor="Hand"
                                                VerticalAlignment="Center" FontSize="10"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Add New Feature -->
                    <StackPanel Orientation="Horizontal">
                        <TextBox Text="{Binding NewOtherFeature, UpdateSourceTrigger=PropertyChanged}" 
                                 Width="300" Margin="0,0,8,0" 
                                 ToolTip="Type a feature and press Add"/>
                        <Button Content="âž• Add Feature" Command="{Binding AddOtherFeatureCommand}" Padding="10,5"/>
                    </StackPanel>
                </StackPanel>

                <!-- Quick Notes (Chips) -->
                <StackPanel Orientation="Horizontal" Grid.Row="11" Grid.Column="0" VerticalAlignment="Top" Margin="0,5">
                    <TextBlock Text="âœŽ" Foreground="#2196F3" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="Notes:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Row="11" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <!-- Current Notes as Chips -->
                    <ItemsControl ItemsSource="{Binding QuickNotesList}" Margin="0,0,0,8">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#5C6BC0" CornerRadius="12" Padding="10,5" Margin="0,0,6,6">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding}" Foreground="White" VerticalAlignment="Center"/>
                                        <Button Content="âœ•" 
                                                Command="{Binding DataContext.RemoveQuickNoteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                CommandParameter="{Binding}"
                                                Background="Transparent" Foreground="White" BorderThickness="0"
                                                Padding="6,0,0,0" FontWeight="Bold" Cursor="Hand"
                                                VerticalAlignment="Center" FontSize="10"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Add New Note -->
                    <StackPanel Orientation="Horizontal">
                        <TextBox Text="{Binding NewQuickNote, UpdateSourceTrigger=PropertyChanged}" 
                                 Width="300" Margin="0,0,8,0" 
                                 ToolTip="Type a quick note and press Add"/>
                        <Button Content="âž• Add Note" Command="{Binding AddQuickNoteCommand}" Padding="10,5"/>
                    </StackPanel>
                </StackPanel>

                <!-- Comments -->
                <StackPanel Orientation="Horizontal" Grid.Row="12" Grid.Column="0" VerticalAlignment="Top" Margin="0,5">
                    <TextBlock Text="â" Foreground="#FF9800" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="Comments:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Row="12" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <!-- Formatting Toolbar -->
                    <ToolBar Background="#F5F5F5" Padding="2" Margin="0,0,0,2">
                        <Button x:Name="BoldButton" Content="B" FontWeight="Bold" Width="28" Height="24"
                                Click="FormatBold_Click" ToolTip="Bold (Ctrl+B)"/>
                        <Button x:Name="ItalicButton" Content="I" FontStyle="Italic" Width="28" Height="24"
                                Click="FormatItalic_Click" ToolTip="Italic (Ctrl+I)"/>
                        <Button x:Name="UnderlineButton" Width="28" Height="24"
                                Click="FormatUnderline_Click" ToolTip="Underline (Ctrl+U)">
                            <TextBlock Text="U" TextDecorations="Underline"/>
                        </Button>
                        <Separator/>
                        <Button x:Name="BulletListButton" Content="â€¢â‰¡" Width="28" Height="24"
                                Click="BulletList_Click" ToolTip="Bullet List"/>
                        <Button x:Name="NumberedListButton" Content="1." Width="28" Height="24"
                                Click="NumberedList_Click" ToolTip="Numbered List"/>
                        <Separator/>
                        <Button x:Name="HighlightYellowButton" Width="28" Height="24"
                                Click="HighlightYellow_Click" ToolTip="Highlight Yellow">
                            <Border Background="Yellow" Width="16" Height="16" CornerRadius="2"/>
                        </Button>
                        <Button x:Name="HighlightGreenButton" Width="28" Height="24"
                                Click="HighlightGreen_Click" ToolTip="Highlight Green">
                            <Border Background="LightGreen" Width="16" Height="16" CornerRadius="2"/>
                        </Button>
                        <Separator/>
                        <Button x:Name="ClearFormattingButton" Content="âœ–" Width="28" Height="24"
                                Click="ClearFormatting_Click" ToolTip="Clear Formatting"/>
                    </ToolBar>
                    <!-- RichTextBox -->
                    <RichTextBox x:Name="CommentsRichTextBox" 
                                 helpers:RichTextBoxBinding.XamlText="{Binding Property.Comments, Mode=TwoWay}"
                                 MinHeight="60" MaxHeight="200"
                                 VerticalScrollBarVisibility="Auto"/>
                </StackPanel>

                <!-- PROs & CONs Section -->
                <StackPanel Orientation="Horizontal" Grid.Row="10" Grid.Column="0" VerticalAlignment="Top" Margin="0,5">
                    <TextBlock Text="âš–" Foreground="#9C27B0" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="PROs/CONs:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
                <Grid Grid.Row="10" Grid.Column="1" Grid.ColumnSpan="10" Margin="0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- PROs Section (Left) -->
                    <Border Grid.Column="0" BorderBrush="ForestGreen" BorderThickness="1" CornerRadius="5" Padding="10">
                        <StackPanel>
                            <TextBlock Text="âœ“ PROs" FontSize="14" FontWeight="Bold" Foreground="ForestGreen" Margin="0,0,0,10"/>
                            
                            <!-- Current PRO Tags -->
                            <ItemsControl ItemsSource="{Binding PropertyProTags}" Margin="0,0,0,10">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="ForestGreen" CornerRadius="3" Padding="8,4" Margin="0,0,5,5">
                                            <Border.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Delete Tag Permanently" 
                                                              Command="{Binding DataContext.DeleteProTagCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                              CommandParameter="{Binding}"/>
                                                </ContextMenu>
                                            </Border.ContextMenu>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" Foreground="White" VerticalAlignment="Center"/>
                                                <Button Content="âœ•" 
                                                        Command="{Binding DataContext.RemoveProTagCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                        CommandParameter="{Binding}"
                                                        Background="Transparent" Foreground="White" BorderThickness="0"
                                                        Padding="5,0,0,0" FontWeight="Bold" Cursor="Hand"
                                                        VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <!-- Add PRO Tag -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <ComboBox ItemsSource="{Binding AvailableProTags}" 
                                          SelectedItem="{Binding SelectedProTag}"
                                          DisplayMemberPath="Name"
                                          Width="180" Margin="0,0,8,0"/>
                                <Button Content="Add" Command="{Binding AddProTagCommand}" Padding="10,3" Background="#E8F5E9"/>
                                <Button Content="ðŸ—‘" Command="{Binding DeleteSelectedProTagCommand}" 
                                        Padding="5,3" Margin="5,0,0,0" Background="#FFEBEE" 
                                        ToolTip="Delete selected tag permanently" FontSize="12"/>
                            </StackPanel>
                            
                            <!-- Create New PRO Tag -->
                            <StackPanel Orientation="Horizontal">
                                <TextBox Text="{Binding NewProTagName, UpdateSourceTrigger=PropertyChanged}" 
                                         Width="180" Margin="0,0,8,0" 
                                         ToolTip="Create a custom PRO"/>
                                <Button Content="Create" Command="{Binding CreateProTagCommand}" Padding="10,3" Background="#E8F5E9"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- CONs Section (Right) -->
                    <Border Grid.Column="2" BorderBrush="Firebrick" BorderThickness="1" CornerRadius="5" Padding="10">
                        <StackPanel>
                            <TextBlock Text="âœ— CONs" FontSize="14" FontWeight="Bold" Foreground="Firebrick" Margin="0,0,0,10"/>
                            
                            <!-- Current CON Tags -->
                            <ItemsControl ItemsSource="{Binding PropertyConTags}" Margin="0,0,0,10">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="Firebrick" CornerRadius="3" Padding="8,4" Margin="0,0,5,5">
                                            <Border.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Delete Tag Permanently" 
                                                              Command="{Binding DataContext.DeleteConTagCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                              CommandParameter="{Binding}"/>
                                                </ContextMenu>
                                            </Border.ContextMenu>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Name}" Foreground="White" VerticalAlignment="Center"/>
                                                <Button Content="âœ•" 
                                                        Command="{Binding DataContext.RemoveConTagCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        CommandParameter="{Binding}"
                                                        Background="Transparent" Foreground="White" BorderThickness="0"
                                                        Padding="5,0,0,0" FontWeight="Bold" Cursor="Hand"
                                                        VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <!-- Add CON Tag -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <ComboBox ItemsSource="{Binding AvailableConTags}" 
                                          SelectedItem="{Binding SelectedConTag}"
                                          DisplayMemberPath="Name"
                                          Width="180" Margin="0,0,8,0"/>
                                <Button Content="Add" Command="{Binding AddConTagCommand}" Padding="10,3" Background="#FFEBEE"/>
                                <Button Content="ðŸ—‘" Command="{Binding DeleteSelectedConTagCommand}" 
                                        Padding="5,3" Margin="5,0,0,0" Background="#FFEBEE" 
                                        ToolTip="Delete selected tag permanently" FontSize="12"/>
                            </StackPanel>
                            
                            <!-- Create New CON Tag -->
                            <StackPanel Orientation="Horizontal">
                                <TextBox Text="{Binding NewConTagName, UpdateSourceTrigger=PropertyChanged}" 
                                         Width="180" Margin="0,0,8,0" 
                                         ToolTip="Create a custom CON"/>
                                <Button Content="Create" Command="{Binding CreateConTagCommand}" Padding="10,3" Background="#FFEBEE"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Property Images (up to 4) -->
                <StackPanel Orientation="Horizontal" Grid.Row="15" Grid.Column="0" Grid.ColumnSpan="11" Margin="0,20,0,10">
                    <TextBlock Text="â–£" Foreground="#E91E63" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="Property Images" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBlock Text=" (click image to enlarge)" FontSize="12" Foreground="#888888" VerticalAlignment="Center" Margin="8,0,0,0"/>
                </StackPanel>
                
                <Grid Grid.Row="16" Grid.Column="0" Grid.ColumnSpan="11">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Image 1 -->
                    <Border Grid.Row="0" Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,10,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding Images.HasImage1, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 1" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding Images.PasteImage1Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding Images.HasImage1, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Images.Image1}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5" 
                                       Cursor="Hand" MouseLeftButtonDown="Image_MouseLeftButtonDown" Tag="1"/>
                                <Button Content="âœ•" Command="{Binding Images.DeleteImage1Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Image 2 -->
                    <Border Grid.Row="0" Grid.Column="1" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,0,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding Images.HasImage2, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 2" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding Images.PasteImage2Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding Images.HasImage2, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Images.Image2}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5"
                                       Cursor="Hand" MouseLeftButtonDown="Image_MouseLeftButtonDown" Tag="2"/>
                                <Button Content="âœ•" Command="{Binding Images.DeleteImage2Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Image 3 -->
                    <Border Grid.Row="1" Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,10,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding Images.HasImage3, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 3" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding Images.PasteImage3Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding Images.HasImage3, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Images.Image3}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5"
                                       Cursor="Hand" MouseLeftButtonDown="Image_MouseLeftButtonDown" Tag="3"/>
                                <Button Content="âœ•" Command="{Binding Images.DeleteImage3Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Image 4 -->
                    <Border Grid.Row="1" Grid.Column="1" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,0,10" MinHeight="180">
                        <Grid>
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                        Visibility="{Binding Images.HasImage4, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <TextBlock Text="Image 4" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                <Button Content="Paste Image" Command="{Binding Images.PasteImage4Command}" Padding="10,5" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Grid Visibility="{Binding Images.HasImage4, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Image Source="{Binding Images.Image4}" MaxHeight="160" MaxWidth="300" Stretch="Uniform" Margin="5"
                                       Cursor="Hand" MouseLeftButtonDown="Image_MouseLeftButtonDown" Tag="4"/>
                                <Button Content="âœ•" Command="{Binding Images.DeleteImage4Command}" 
                                        VerticalAlignment="Top" HorizontalAlignment="Right" 
                                        Padding="5,2" Margin="5" FontWeight="Bold" Background="#FF6B6B" Foreground="White"/>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Attachments -->
                <StackPanel Orientation="Horizontal" Grid.Row="13" Grid.Column="0" Grid.ColumnSpan="11" Margin="0,20,0,10">
                    <TextBlock Text="âœ¿" Foreground="#00BCD4" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="Attachments" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                </StackPanel>
                
                <Grid Grid.Row="14" Grid.Column="0" Grid.ColumnSpan="11">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <Button Content="Add Attachment" Command="{Binding AddAttachmentCommand}" HorizontalAlignment="Left" Margin="0,0,0,10" Padding="10,5"/>
                    
                    <ListView ItemsSource="{Binding Attachments}" Grid.Row="1" MaxHeight="200" BorderThickness="1" BorderBrush="#CCCCCC">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="File Name" Width="250" DisplayMemberBinding="{Binding FileName}"/>
                                <GridViewColumn Header="Date" Width="100" DisplayMemberBinding="{Binding DateAdded, StringFormat=d}"/>
                                <GridViewColumn Header="Actions" Width="150">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Button Content="Open" Command="{Binding DataContext.OpenAttachmentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Margin="0,0,5,0" Padding="5,2"/>
                                                <Button Content="Delete" Command="{Binding DataContext.DeleteAttachmentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Padding="5,2"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Notes" Width="450">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBox Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                     TextWrapping="Wrap" AcceptsReturn="True" 
                                                     MinHeight="40" MaxHeight="80" Width="430"
                                                     VerticalScrollBarVisibility="Auto"
                                                     BorderThickness="1" BorderBrush="#CCCCCC" Padding="3"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>

                <!-- Mortgage Calculator -->
                <local:MortgageCalculatorView Grid.Row="17" Grid.Column="0" Grid.ColumnSpan="11" DataContext="{Binding MortgageCalculator}"/>

            </Grid>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Save" Command="{Binding SaveCommand}" Width="100" Margin="0,0,10,0" Padding="10,5"/>
            <Button Content="Cancel" Command="{Binding CancelCommand}" Width="100" Padding="10,5"/>
        </StackPanel>
    </Grid>
</UserControl>
